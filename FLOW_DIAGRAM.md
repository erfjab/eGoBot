# Ø¬Ø±ÛŒØ§Ù† Ú©Ø§Ø± State Management Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§ÙØªÙ‡

## Ù‚Ø¨Ù„ Ø§Ø² ØªØºÛŒÛŒØ±Ø§Øª:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Update Ù…ÛŒâ€ŒØ¢ÛŒØ¯                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Handler Ù¾ÛŒØ¯Ø§ Ù…ÛŒØ´Ù‡ Ú©Ù‡ Filter Ù…Ú† Ø´Ø¯Ù‡                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Ø§Ú¯Ø± State Filter Ø¯Ø§Ø±Ù‡:                                 â”‚
â”‚    â”œâ”€ GetState() Ù…ÛŒØ²Ù†Ù‡ Ø¨Ù‡ Storage  â† Query #1             â”‚
â”‚    â””â”€ State Ú†Ú© Ù…ÛŒØ´Ù‡ Ø¨Ø§ Filter                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Handler Ø§Ø¬Ø±Ø§ Ù…ÛŒØ´Ù‡                                       â”‚
â”‚    â”œâ”€ Context Ø®Ø§Ù„ÛŒÙ‡!                                       â”‚
â”‚    â””â”€ Ø¨Ø§ÛŒØ¯ Ø¯Ø³ØªÛŒ GetData() Ø¨Ø²Ù†ÛŒ  â† Query #2                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”´ Ù…Ø´Ú©Ù„Ø§Øª:
   - 2 Query Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø¨Ù‡ Storage
   - Ú©Ø¯ ØªÚ©Ø±Ø§Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ù„ÙˆØ¯ data
   - Ø§Ø­ØªÙ…Ø§Ù„ Ø®Ø·Ø§ Ø¯Ø± ÙØ±Ø§Ù…ÙˆØ´ÛŒ Ù„ÙˆØ¯ data
```

---

## Ø¨Ø¹Ø¯ Ø§Ø² ØªØºÛŒÛŒØ±Ø§Øª:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Update Ù…ÛŒâ€ŒØ¢ÛŒØ¯                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Handler Ù¾ÛŒØ¯Ø§ Ù…ÛŒØ´Ù‡ Ú©Ù‡ Filter Ù…Ú† Ø´Ø¯Ù‡                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Ø§Ú¯Ø± State Filter Ø¯Ø§Ø±Ù‡:                                 â”‚
â”‚    â”œâ”€ GetContext() Ù…ÛŒØ²Ù†Ù‡  â† Query #1 (Ù‡Ù… State Ùˆ Ù‡Ù… Data)  â”‚
â”‚    â”œâ”€ State Ú†Ú© Ù…ÛŒØ´Ù‡ Ø¨Ø§ Filter                              â”‚
â”‚    â””â”€ State Ùˆ Data ØªÙˆÛŒ Context Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒØ´Ù‡                  â”‚
â”‚       â”œâ”€ ctx.Set("state", userContext.State)               â”‚
â”‚       â”œâ”€ ctx.Set("data", userContext.Data)                 â”‚
â”‚       â””â”€ ctx.Set("state_obj", State object)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Handler Ø§Ø¬Ø±Ø§ Ù…ÛŒØ´Ù‡                                       â”‚
â”‚    â”œâ”€ Context Ù¾Ø± Ø§Ø² Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª! âœ…                           â”‚
â”‚    â”œâ”€ ctx.GetStateName() â†’ state name                      â”‚
â”‚    â””â”€ ctx.GetStateData() â†’ data map                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸŸ¢ Ù…Ø²Ø§ÛŒØ§:
   âœ… ÙÙ‚Ø· 1 Query Ø¨Ù‡ Storage
   âœ… Ø¨Ø¯ÙˆÙ† Ú©Ø¯ ØªÚ©Ø±Ø§Ø±ÛŒ
   âœ… State Ùˆ Data Ù‡Ù…ÛŒØ´Ù‡ Ø¯Ø± Ø¯Ø³ØªØ±Ø³
   âœ… Performance Ø¨Ù‡ØªØ±
```

---

## Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø¯ Ø¯Ø± Handler:

### âŒ Ù‚Ø¨Ù„ (Ú©Ø¯ ØªÚ©Ø±Ø§Ø±ÛŒ Ùˆ 2 query):
```go
func handleMessage(bot *core.Bot, update *models.Update, ctx *core.Context) error {
    userID := update.Message.From.ID
    userManager := bot.StateManager.ForUser(userID)
    
    // Query #1
    currentState, err := userManager.GetState(context.Background())
    if err != nil {
        return err
    }
    
    // Query #2
    stateData, err := userManager.GetData(context.Background())
    if err != nil {
        return err
    }
    
    // Ø­Ø§Ù„Ø§ Ù…ÛŒØªÙˆÙ†ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒ
    name := stateData["name"]
    // ...
}
```

### âœ… Ø¨Ø¹Ø¯ (Ø³Ø§Ø¯Ù‡ Ùˆ 0 query):
```go
func handleMessage(bot *core.Bot, update *models.Update, ctx *core.Context) error {
    // Ù‡Ù…Ù‡ Ú†ÛŒ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª!
    stateName := ctx.GetStateName()
    stateData := ctx.GetStateData()
    
    if stateData != nil {
        name := stateData["name"]
        // ...
    }
}
```

---

## Ø¬Ø±ÛŒØ§Ù† Ø¯Ø§Ø¯Ù‡ Ø¯Ø± Storage:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Storage (Memory/Redis/...)             â”‚
â”‚                                                â”‚
â”‚  UserContext {                                 â”‚
â”‚    State: "user.waiting_for_name"              â”‚
â”‚    Data: {                                     â”‚
â”‚      "name": "Ø¹Ù„ÛŒ",                             â”‚
â”‚      "age": "25",                               â”‚
â”‚      "step": 2                                 â”‚
â”‚    }                                           â”‚
â”‚  }                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ GetContext() - ÛŒÚ© Query
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Handler Context                   â”‚
â”‚                                                â”‚
â”‚  ctx.Get("state")      â†’ "user.waiting_for..." â”‚
â”‚  ctx.Get("data")       â†’ map[string]interface{}â”‚
â”‚  ctx.Get("state_obj")  â†’ *State                â”‚
â”‚                                                â”‚
â”‚  // Helper methods:                            â”‚
â”‚  ctx.GetStateName()    â†’ "user.waiting_for..." â”‚
â”‚  ctx.GetStateData()    â†’ map with data         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Handler Function   â”‚
         â”‚   Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¢Ø³Ø§Ù† Ø§Ø²   â”‚
         â”‚   state Ùˆ data      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
